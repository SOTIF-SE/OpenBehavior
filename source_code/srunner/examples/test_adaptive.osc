import basic.osc
import adaptive1.osc

scenario top:
    path: Path
    path.set_map("Town04")
    path.path_min_driving_lanes(2)

    ego_vehicle: Model3
    npc1: Rubicon
    npc2: TT
    npc3: A2

    adaptive_targets: list of string = [npc2,npc3]
    scenario_mode: string = "diverse"
    user_adaptive_npc_bm : string = adapt_npc_bm.adapt(scenario_mode: scenario_mode)

    do parallel:
        ego_vehicle.drive(path) with:
            set_behavior_model(behavior_type: Script, model: internal_npc, hyperparameters: Default)
            set_behavior_logic(
                lane:"2, at:start",
                position:"0, at:start",
                lane:"2, at:end",
                position:"200, at:end"
            )
        auto_orchestrates_behavior(user_adaptive_npc_bm, adaptive_targets)
        serial:
            start:parallel(duration: 10s):
                npc1.drive(path) with:
                    set_behavior_model(behavior_type: AI, model: Interfuser, hyperparameters: "max_acc=5, max_speed=10")
                    set_behavior_logic(
                        lane:"2, at:start",
                        position:"30, behind:ego_vehicle, at:start",
                        lane:"2, right_of: ego_vehicle, at:end",
                        position:"10, behind:ego_vehicle, at:end"
                    )
            cut_in:parallel(duration: 10s):
                npc1.drive(path) with:
                    set_behavior_model(behavior_type: Script, model: internal_npc, hyperparameters: Default)
                    set_behavior_logic(
                        lane:"2, at:start",
                        position:"10, behind:ego_vehicle, at:start",
                        lane:"3, right_of: ego_vehicle, at:end",
                        position:"30, ahead_of:ego_vehicle, at:end"
                    )
            follow:parallel(duration: 10s):
                npc1.drive(path) with:
                    set_behavior_model(behavior_type: AI, model: Interfuser, hyperparameters: "max_acc=5, max_speed=10")
                    set_behavior_logic(
                        lane:"3, at:start",
                        position:"30, ahead_of:ego_vehicle, at:start",
                        lane:"2, right_of: ego_vehicle, at:end",
                        position:"70, ahead_of:ego_vehicle, at:end"
                    )
